<div class="inline-wrap">
    <div class="form-input clearfix blocks half-block required">
        <label for="input-text">Dashboard Username:</label>
        <input class="postman-env" type="text" value="" id="db_user" />
        <div class="help">Your username to signin to Bandwidth Dashboard</div>
    </div>
    <div class="form-input clearfix blocks half-block required">
        <label for="input-text">Dashboard Password:</label>
        <input class="postman-env" type="text" value="" id="db_password" />
        <div class="help">Your Password to signin to Bandwidth Dashboard</div>
    </div>
</div>
<div class="inline-wrap">
    <div class="form-input clearfix blocks half-block required">
        <label for="input-text">Dashboard Account Id:</label>
        <input class="postman-env" type="text" value="" id="db_account_id" />
        <div class="help">Your Bandwidth Dashboard Accound ID</div>
    </div>
    <div class="form-input clearfix blocks half-block required">
        <label for="input-text">Dashboard Sub-account Id:</label>
        <input class="postman-env" type="text" value="" id="db_subaccount_id" />
        <div class="help">Your Bandwidth Dashboard Sub-account Id</div>
    </div>
</div>
<div class="inline-wrap">
    <div class="form-input clearfix blocks medium-block required">
        <label for="input-text">Messaging API User Id:</label>
        <input class="postman-env" type="text" value="" id="messaging_user_id" />
        <div class="help">Your Messaging API User Id</div>
    </div>
    <div class="form-input clearfix blocks medium-block required">
        <label for="input-text">Messaging API Token:</label>
        <input class="postman-env" type="text" value="" id="messaging_api_token" />
        <div class="help">Your Messaging API Token</div>
    </div>
    <div class="form-input clearfix blocks medium-block required">
        <label for="input-text">Messaging API Secret:</label>
        <input class="postman-env" type="text" value="" id="messaging_api_secret" />
        <div class="help">Your Messaging API Secret</div>
    </div>
</div>

<div id="postman-container" hidden>
<div class="postman-run-button"
data-postman-action="collection/import"
data-postman-var-1="53bb13675c43def87aaf"
data-postman-param="env%5BBandwidth%20API%20Keys%5D=W3sia2V5IjoidXNlciIsInZhbHVlIjoiIiwiZGVzY3JpcHRpb24iOiIiLCJ0eXBlIjoidGV4dCIsImVuYWJsZWQiOnRydWV9LHsia2V5IjoicGFzc3dvcmQiLCJ2YWx1ZSI6IiIsImRlc2NyaXB0aW9uIjoiIiwidHlwZSI6InRleHQiLCJlbmFibGVkIjp0cnVlfSx7ImtleSI6InVzZXJJZCIsInZhbHVlIjoiIiwiZGVzY3JpcHRpb24iOiIiLCJ0eXBlIjoidGV4dCIsImVuYWJsZWQiOnRydWV9LHsia2V5IjoidG9rZW4iLCJ2YWx1ZSI6IiIsImRlc2NyaXB0aW9uIjoiIiwidHlwZSI6InRleHQiLCJlbmFibGVkIjp0cnVlfSx7ImtleSI6InNlY3JldCIsInZhbHVlIjoiIiwiZGVzY3JpcHRpb24iOiIiLCJ0eXBlIjoidGV4dCIsImVuYWJsZWQiOnRydWV9LHsia2V5Ijoic3ViYWNjb3VudCIsInZhbHVlIjoiIiwiZGVzY3JpcHRpb24iOiIiLCJ0eXBlIjoidGV4dCIsImVuYWJsZWQiOnRydWV9XQ=="></div></div>
<script type="text/javascript">
  (function (p,o,s,t,m,a,n) {
    !p[s] && (p[s] = function () { (p[t] || (p[t] = [])).push(arguments); });
    !o.getElementById(s+t) && o.getElementsByTagName("head")[0].appendChild((
      (n = o.createElement("script")),
      (n.id = s+t), (n.async = 1), (n.src = m), n
    ));
  }(window, document, "_pm", "PostmanRunObject", "https://run.pstmn.io/button.js"));

const checkAllVal = function (obj) {
    var result = true;

    for (var i in obj) {
        if (obj[i] === '') {
            result = false;
            break;
        }
    }
    return result;
}

const updateEnv = function () {
//instead of triggering on button, do onchange (keyup, paste, enter, tab, bbrown will send all this fun stuff)
    const user       = document.getElementById("db_user").value;
    const password   = document.getElementById("db_password").value;
    const account    = document.getElementById("db_account_id").value;
    const userId     = document.getElementById("messaging_user_id").value;
    const token      = document.getElementById("messaging_api_token").value;
    const secret     = document.getElementById("messaging_api_secret").value;
    const subaccount = document.getElementById("db_subaccount_id").value;
    const envData = {
      user       : user,
      password   : password,
      account    : account,
      userId     : userId,
      token      : token,
      secret     : secret,
      subaccount : subaccount
    };
    console.log(envData);
    //INstead of creating, replace. will need update collection to contain default empty enviornment
    if (checkAllVal(envData)) {
        console.log('All set, updating postman');
        _pm("env.replace", "Bandwidth API Keys", envData);
        document.querySelector('#postman-container').style.display = '';
    }
}

document.querySelectorAll(".postman-env").addEventListener("change", updateEnv, false);
document.querySelectorAll(".postman-env").addEventListener("keyup", updateEnv, false);
document.querySelectorAll(".postman-env").addEventListener("paste", updateEnv, false);


// document.getElementById("db_user").addEventListener("change", updateEnv, false);
// document.getElementById("db_password").addEventListener("change", updateEnv, false);
// document.getElementById("db_account_id").addEventListener("change", updateEnv, false);
// document.getElementById("messaging_user_id").addEventListener("change", updateEnv, false);
// document.getElementById("messaging_api_token").addEventListener("change", updateEnv, false);
// document.getElementById("messaging_api_secret").addEventListener("change", updateEnv, false);
// document.getElementById("db_subaccount_id").addEventListener("change", updateEnv, false);

// document.getElementById("db_user").addEventListener("keyup", updateEnv, false);
// document.getElementById("db_password").addEventListener("keyup", updateEnv, false);
// document.getElementById("db_account_id").addEventListener("keyup", updateEnv, false);
// document.getElementById("messaging_user_id").addEventListener("keyup", updateEnv, false);
// document.getElementById("messaging_api_token").addEventListener("keyup", updateEnv, false);
// document.getElementById("messaging_api_secret").addEventListener("keyup", updateEnv, false);
// document.getElementById("db_subaccount_id").addEventListener("keyup", updateEnv, false);

// document.getElementById("db_user").addEventListener("paste", updateEnv, false);
// document.getElementById("db_password").addEventListener("paste", updateEnv, false);
// document.getElementById("db_account_id").addEventListener("paste", updateEnv, false);
// document.getElementById("messaging_user_id").addEventListener("paste", updateEnv, false);
// document.getElementById("messaging_api_token").addEventListener("paste", updateEnv, false);
// document.getElementById("messaging_api_secret").addEventListener("paste", updateEnv, false);
// document.getElementById("db_subaccount_id").addEventListener("paste", updateEnv, false);

</script>
